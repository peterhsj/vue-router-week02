import{a as v}from"./axios-BimPEqV4.js";import{r as s,d as se,f as u,c as B,g as e,h as t,i as b,j as D,a as g,t as R,F as ue,o as m,k as d,n as S}from"./index-CE3ggQXN.js";const de=g("span",{class:"font-weight-black"},"Welcome to Todo API",-1),ce=g("h2",null,"註冊",-1),ie=g("h2",null,"登入",-1),re={key:1,class:"text-center my-5"},ve={key:2},me=g("h2",{class:"py-3"},"代辦事項",-1),_e=g("span",{class:"text-h5"},"編輯",-1),_="https://todolist-api.hexschool.io",ge={__name:"TodoView",setup(pe){const V=s(!1),y=s(""),r=s(""),F=s(!0),w=()=>{y.value=""},p=s({email:"",password:"",nickname:""}),W=s(""),q=async()=>{try{const a=await v.post(`${_}/users/sign_up`,p.value);W.value=a.data.uid,V.value=!1,w()}catch(a){y.value=`${a.response.data.message}`}},h=s({email:"",password:""}),G=s(""),H=async()=>{try{const a=await v.post(`${_}/users/sign_in`,h.value);G.value=a.data.token,document.cookie=`customTodoToken=${a.data.token}; expires=${new Date+1}; path=/`,w(),j()}catch(a){y.value=`${a.response.data.message}`}},$=s({}),j=async()=>{r.value=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");const a=await v.get(`${_}/users/checkout`,{headers:{Authorization:r.value}});$.value=a.data,F.value=!1,x()},K=async()=>{try{const a=await v.post(`${_}/users/sign_out`,{},{headers:{Authorization:r.value}});$.value={},F.value=a.data.status,document.cookie="customTodoToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}catch(a){console.log({err:a})}},C=s({content:null}),Q=async()=>{const a={...C.value};try{const l=await v.post(`${_}/todos`,a,{headers:{Authorization:r.value}});x(),C.value.content=null}catch(l){console.log({err:l})}},X=s([{title:"待辦事項",align:"start",sortable:!1,key:"content"},{title:"操作",sortable:!1,key:"actions",align:"end"}]),E=s([]),i=s({}),T=s(!1),z=s(!1),x=async()=>{try{const a=await v.get(`${_}/todos`,{headers:{Authorization:r.value}});E.value=a.data.data}catch(a){console.log({err:a})}},Y=a=>{i.value={...a},T.value=!0},Z=a=>{z.value=!0,i.value={...a}},ee=async()=>{const a=i.value.id;try{const l=await v.delete(`${_}/todos/${a}`,{headers:{Authorization:r.value}});x(),P()}catch(l){console.log({err:l})}},M=()=>{T.value=!1,S(()=>{i.value={}})},P=()=>{z.value=!1,S(()=>{i.value={}})},te=async()=>{const a=i.value.id,l={content:i.value.content};try{const n=await v.put(`${_}/todos/${a}`,l,{headers:{Authorization:r.value}});x(),M()}catch(n){console.log({err:n})}};return se(()=>{r.value&&(j(),x())}),(a,l)=>{const n=u("v-col"),c=u("v-btn"),f=u("v-row"),k=u("v-text-field"),U=u("v-container"),A=u("v-card-text"),I=u("v-card"),le=u("v-alert"),ae=u("v-divider"),oe=u("v-data-table"),J=u("v-card-title"),N=u("v-spacer"),L=u("v-card-actions"),O=u("v-dialog");return m(),B(ue,null,[e(I,{class:"mx-auto","prepend-icon":"$vuetify",width:"400"},{title:t(()=>[de]),default:t(()=>[F.value?(m(),b(A,{key:0,class:"bg-surface-light pt-4"},{default:t(()=>[V.value?(m(),b(U,{key:0},{default:t(()=>[e(f,{align:"center",justify:"space-between"},{default:t(()=>[e(n,{cols:"12",lg:"6"},{default:t(()=>[ce]),_:1}),e(n,{cols:"12",lg:"6",class:"text-right"},{default:t(()=>[e(c,{onClick:l[0]||(l[0]=o=>{V.value=!1,w()}),flat:""},{default:t(()=>[d("返回登入")]),_:1})]),_:1})]),_:1}),e(f,null,{default:t(()=>[e(n,{cols:"12"},{default:t(()=>[e(k,{type:"email",modelValue:p.value.email,"onUpdate:modelValue":l[1]||(l[1]=o=>p.value.email=o),density:"compact",label:"E-mail",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(n,{cols:"12"},{default:t(()=>[e(k,{type:"password",modelValue:p.value.password,"onUpdate:modelValue":l[2]||(l[2]=o=>p.value.password=o),density:"compact",label:"Password",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(n,{cols:"12"},{default:t(()=>[e(k,{type:"text",modelValue:p.value.nickname,"onUpdate:modelValue":l[3]||(l[3]=o=>p.value.nickname=o),density:"compact",label:"Nickname",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(n,{cols:"12"},{default:t(()=>[e(c,{type:"button",class:"text-none mb-4",color:"indigo-darken-3",size:"x-large",variant:"flat",onClick:q,block:""},{default:t(()=>[d("註冊")]),_:1})]),_:1})]),_:1})]),_:1})):(m(),b(U,{key:1},{default:t(()=>[e(f,{align:"center",justify:"space-between"},{default:t(()=>[e(n,{cols:"12",lg:"6"},{default:t(()=>[ie]),_:1}),e(n,{cols:"12",lg:"6",class:"text-right"},{default:t(()=>[e(c,{onClick:l[4]||(l[4]=o=>{V.value=!0,w()}),flat:""},{default:t(()=>[d("我要註冊")]),_:1})]),_:1})]),_:1}),e(f,null,{default:t(()=>[e(n,{cols:"12"},{default:t(()=>[e(k,{type:"email",modelValue:h.value.email,"onUpdate:modelValue":l[5]||(l[5]=o=>h.value.email=o),density:"compact",label:"E-mail",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(n,{cols:"12"},{default:t(()=>[e(k,{type:"text",modelValue:h.value.password,"onUpdate:modelValue":l[6]||(l[6]=o=>h.value.password=o),density:"compact",label:"Password",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(n,{cols:"12"},{default:t(()=>[e(c,{type:"button",class:"text-none mb-4",color:"indigo-darken-3",size:"x-large",variant:"flat",onClick:H,block:""},{default:t(()=>[d("登入")]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1})):(m(),b(A,{key:1,class:"bg-surface-light pt-4"},{default:t(()=>[e(c,{type:"button",color:"indigo-darken-3",onClick:K,block:""},{default:t(()=>[d("登出")]),_:1})]),_:1}))]),_:1}),y.value?(m(),b(le,{key:0,text:y.value,title:"錯誤訊息：",density:"compact",type:"warning",width:"400",class:"mx-auto my-3"},null,8,["text"])):D("",!0),$.value.uid?(m(),B("div",re,[g("h2",null,R($.value.nickname)+"，歡迎光臨",1),e(ae)])):D("",!0),r.value?(m(),B("div",ve,[me,g("div",null,[e(I,null,{default:t(()=>[e(A,{class:"bg-surface-light pt-4"},{default:t(()=>[e(U,null,{default:t(()=>[e(f,null,{default:t(()=>[e(n,{cols:"4"},{default:t(()=>[e(k,{type:"text",modelValue:C.value.content,"onUpdate:modelValue":l[7]||(l[7]=o=>C.value.content=o),density:"compact",placeholder:"請輸入代辦事項",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(n,{cols:"2"},{default:t(()=>[e(c,{type:"button",class:"text-none",color:"indigo-darken-3",variant:"flat",onClick:Q,block:""},{default:t(()=>[d("新增")]),_:1})]),_:1})]),_:1}),e(f,null,{default:t(()=>[e(n,{cols:"12"},{default:t(()=>[e(oe,{headers:X.value,items:E.value},{"item.actions":t(({item:o})=>[e(c,{class:"me-2",size:"small",onClick:ne=>Y(o)},{default:t(()=>[d(" 編輯 ")]),_:2},1032,["onClick"]),e(c,{size:"small",onClick:ne=>Z(o)},{default:t(()=>[d(" 刪除 ")]),_:2},1032,["onClick"])]),"no-data":t(()=>[d(" 尚無資料 ")]),_:1},8,["headers","items"]),e(O,{modelValue:T.value,"onUpdate:modelValue":l[9]||(l[9]=o=>T.value=o),"max-width":"500px"},{default:t(()=>[e(I,null,{default:t(()=>[e(J,null,{default:t(()=>[_e]),_:1}),e(A,null,{default:t(()=>[e(U,null,{default:t(()=>[e(f,null,{default:t(()=>[e(n,{cols:"12"},{default:t(()=>[e(k,{modelValue:i.value.content,"onUpdate:modelValue":l[8]||(l[8]=o=>i.value.content=o),label:"待辦事項"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(L,null,{default:t(()=>[e(N),e(c,{color:"blue-darken-1",variant:"text",onClick:M},{default:t(()=>[d(" 取消 ")]),_:1}),e(c,{color:"blue-darken-1",variant:"text",onClick:te},{default:t(()=>[d(" 儲存 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(O,{modelValue:z.value,"onUpdate:modelValue":l[10]||(l[10]=o=>z.value=o),"max-width":"500px"},{default:t(()=>[e(I,null,{default:t(()=>[e(J,{class:"text-h5"},{default:t(()=>[d("確認刪除 "+R(i.value.content)+" 這個項目 ?",1)]),_:1}),e(L,null,{default:t(()=>[e(N),e(c,{color:"blue-darken-1",variant:"text",onClick:P},{default:t(()=>[d("取消")]),_:1}),e(c,{color:"blue-darken-1",variant:"text",onClick:ee},{default:t(()=>[d("確認")]),_:1}),e(N)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])])):D("",!0)],64)}}};export{ge as default};
